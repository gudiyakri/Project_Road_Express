<% include ../partials/header %> <% include ../partials/sidebar %>

<div class="page-wrapper">
	<div class="container-fluid">
		<div class="col-md-12">
			<% include ../partials/message %>
			<div class="row page-titles">
				<div class="col-md-6 col-8 align-self-center">
					<h3 class="text-themecolor mb-0 mt-0">Dashboard</h3>
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="javascript:void(0)">Operations</a></li>
						<li class="breadcrumb-item active">Add Driver</li>
					</ol>
				</div>
			</div>
			<div class="card">
				<div class="card-body pb-0">
					<ul class="nav nav-tabs customtab2" role="tablist">
						<li class="nav-item col-md-4 text-center">
							<a class="nav-link active" data-toggle="tab" href="#addDriver" role="tab"
								><span class="hidden-sm-up"><i class="ti-home"></i></span> <span class="hidden-xs-down">Add Driver</span></a
							>
						</li>
						<li class="nav-item col-md-4 text-center">
							<a class="nav-link" data-toggle="tab" href="#validateDriver" role="tab"
								><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down">Validate Driver</span></a
							>
						</li>

						<li class="nav-item col-md-4 text-center">
							<a class="nav-link" data-toggle="tab" href="#validatedDriver" role="tab"
								><span class="hidden-sm-up"><i class="ti-email"></i></span> <span class="hidden-xs-down">Validated Drivers</span></a
							>
						</li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane active" id="addDriver" role="tabpanel">
							<div class="p-3">
								<form class="form-horizontal" method="POST" action="/admin/addDriver" enctype="multipart/form-data" style="margin-left: 125px">
									<div class="row">
										<div class="col-md-5 col-md-4">
											<h5 class="mt-4 mb-2">Select Transporter</h5>
											<select class="select2 mb-3 mr-2 btn btn-info btn-round trans" name="trans" title="Choose Transporter" required>
												<option disabled selected>Choose</option>
												<option value="self">Self Transporter</option>
												<% for( let i = 0; i < trans.length; i++ ) { %>
												<option value="<%= trans[i].id %>"><%= trans[i].id %> - <%= trans[i].name %> /<%= trans[i].sahar %></option>
												<% } %>
											</select>
										</div>
									</div>
									<div class="row">
										<div class="col-md-4 col-md-6">
											<h5 class="mt-4 mb-2">Name</h5>
											<input type="text" class="form-control col-md-12" name="name" placeholder="Name" required />
										</div>
									</div>
									<div class="row">
										<div class="col-md-5 col-md-4">
											<h5 class="mt-4 mb-2">Select state</h5>
											<select class="select2 mb-3 mr-2 btn btn-info btn-round state" name="state" data-size="10" title="Choose State" required>
												<% for( let i = 0; i < state.length; i++ ) { %>
												<option value="<%= state[i].state %>"><%= state[i].state %></option>

												<% } %>
											</select>
										</div>
										<div class="col-md-5 col-md-4">
											<h5 class="mt-4 mb-2">Select City</h5>
											<select class="select2 mb-3 mr-2 btn btn-info btn-round id1" name="city" required>
												<option disabled selected value>Choose</option>
											</select>
										</div>
									</div>
									<div class="row">
										<div class="col-md-4 col-md-6">
											<h5 class="mt-4 mb-2">Mobile Number</h5>
											<input type="text" class="form-control col-md-12" name="phn" placeholder="Mobile Number" maxlength="10" minlength="10" required />
										</div>
									</div>
									<div class="row">
										<div class="col-md-4 col-md-6">
											<h5 class="mt-4 mb-2">Birthday</h5>
											<div class="input-group">
												<input type="text" class="form-control datepicker" name="birthday" required placeholder="DD/MM/YYYY" />
												<div class="input-group-append">
													<span class="input-group-text"><i class="icon-calender"></i></span>
												</div>
											</div>
										</div>
									</div>
									
									
								
									<div class="row">
										<div class="col-md-4 col-md-6">
											<h5 class="mt-4 mb-2">D.L. Expiration Date</h5>
											<div class="input-group">
												<input type="text" class="form-control datepicker" name="lice_exp" required placeholder="DD/MM/YYYY" />
												<div class="input-group-append">
													<span class="input-group-text"><i class="icon-calender"></i></span>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-4 col-md-6">
											<h5 class="mt-4 mb-2">Password</h5>
											<input type="password" class="form-control col-md-12" name="password" s placeholder="Password" required />
										</div>
									</div>
									<br />
									<div class="row">
										<div class="col-md-6 col-md-6">
											<div class="card">
												<div class="card-body">
													<h5 class="card-title">Profile Pic</h5>
													<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
													<input type="file" name="prof_pic" accept="image/*" required class="dropify" />
												</div>
											</div>
										</div>
										<div class="col-md-6 col-md-6">
											<div class="card">
												<div class="card-body">
													<h5 class="card-title">Driver's License Front Pic</h5>
													<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
													<input type="file" name="dl_pic_front" accept="image/*" required class="dropify" />
												</div>
											</div>
										</div>
										<div class="col-md-6 col-md-6">
											<div class="card">
												<div class="card-body">
													<h5 class="card-title">Driver's License Back Pic</h5>
													<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
													<input type="file" name="dl_pic_back" required class="dropify" />
												</div>
											</div>
										</div>
										<div class="col-md-6 col-md-6">
											<div class="card">
												<div class="card-body">
													<h5 class="card-title">Aadhaar Front</h5>
													<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
													<input type="file" name="aadhar_front_pic" accept="image/*" required class="dropify" />
												</div>
											</div>
										</div>
										<div class="col-md-6 col-md-6">
											<div class="card">
												<div class="card-body">
													<h5 class="card-title">Aadhaar Back</h5>
													<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
													<input type="file" name="aadhar_pic_back" accept="image/*" required class="dropify" />
												</div>
											</div>
										</div>
									</div>
									<br />
									<button type="submit" style="margin-left: 250px" class="btn waves-effect waves-light btn-rounded btn-info">ADD</button>
								</form>
							</div>
						</div>
						<div class="tab-pane p-3" id="validateDriver" role="tabpanel">
							<div class="card-body">
								<h4 class="card-title">Unverified Table</h4>
								<div class="table-responsive m-t-40">
									<table id="datatable" class="display nowrap table table-hover table-striped table-bordered" cellspacing="0" width="100%">
										<thead class="bg-inverse text-white">
											<tr>
												<th>Name</th>
												<th>State</th>
												<th>City</th>
												<th>Mobile No.</th>
												<th>Transporter Name</th>
												<th>Aadhaar</th>
												<th>D.L. Frontside</th>
												<th>D.L. Backside</th>
												<th>Added From</th>
												<th>Action</th>
											</tr>
										</thead>
										<tbody>
											<% for( let j = 0; j < driver.length; j++ ) { %> <% if(driver[j].verif_flag==0){%>
											<tr>
												<td><%= driver[j].d_name %></td>
												<td><%= driver[j].state %></td>
												<td><%= driver[j].sahar %></td>
												<td><%= driver[j].phn %></td>
												<td><%= driver[j].name %></td>
												<td>
													<a href="/admin/display/aadhar/<%= driver[j].aadhar_front_pic %>"
														><img src="/images/aadhar_front_pic/<%= driver[j].aadhar_front_pic %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td>
													<a href="/admin/display/dl_front/<%= driver[j].dl_pic_front %>"
														><img src="/images/dl_pic_front/<%= driver[j].dl_pic_front %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td>
													<a href="/admin/display/dl_back/<%= driver[j].dl_pic_back %>"
														><img src="/images/dl_pic_back/<%= driver[j].dl_pic_back %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td><% if(driver[j].add_by==0){%> Added From Dashboard <%} else{%> Added From APP <%}%></td>
												<td>
													<button class="btn btn-outline-default btn-round" onclick="validDriver('<%= driver[j].Did %>')">Validate Driver!</button>
												</td>
											</tr>
											<% } %> <% } %>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="tab-pane p-3" id="validatedDriver" role="tabpanel">
							<div class="card-body">
								<h4 class="card-title">Verified List</h4>
								<div class="table-responsive m-t-40">
									<table id="datatable2" class="table table-bordered table-striped">
										<thead class="bg-inverse text-white">
											<tr>
												<th>Name</th>
												<th>State</th>
												<th>City</th>
												<th>Mobile No.</th>
												<th>Transporter Name</th>
												<th>Aadhaar</th>
												<th>License Frontside</th>
												<th>License Frontside</th>
												<th>Added From</th>
												<th>Action</th>
												<th>View</th>
											</tr>
										</thead>
										<tbody>
											<% for( let j = 0; j < driver.length; j++ ) { %> <% if(driver[j].verif_flag==1){%>
											<tr>
												<td><%= driver[j].d_name %></td>
												<td><%= driver[j].state %></td>
												<td><%= driver[j].sahar %></td>
												<td><%= driver[j].phn %></td>
												<td><%= driver[j].name %></td>
												<td>
													<a href="/admin/display/aadhar/<%= driver[j].aadhar_front_pic %>"
														><img src="/images/aadhar_front_pic/<%= driver[j].aadhar_front_pic %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td>
													<a href="/admin/display/dl_front/<%= driver[j].dl_pic_front %>"
														><img src="/images/dl_pic_front/<%= driver[j].dl_pic_front %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td>
													<a href="/admin/display/dl_back/<%= driver[j].dl_pic_back %>"
														><img src="/images/dl_pic_back/<%= driver[j].dl_pic_back %>" style="width: 50px; height: 60px"
													/></a>
												</td>
												<td><% if(driver[j].add_by==0){%> Added From Dashboard <%} else{%> Added From APP <%}%></td>
												<td>
													<a class="btn btn-outline-default btn-round" data-toggle="modal" data-driver="<%=driver[j].Did%>" data-target="#updateDriver"
														>Edit</a
													>
												</td>
												<td>
													<a class="btn btn-outline-default btn-round" href="/admin/driverInfo/<%=driver[j].Did%>">View</a>
												</td>
											</tr>
											<% } %> <% } %>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer class="footer">© 2019 Road Express by CodeBuckets.in</footer>
	</div>
</div>

<div class="modal fade" id="updateDriver" tabindex="-1" role="dialog" aria-labelledby="mapmodal1">
	<div class="modal-dialog modal-xl" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="exampleModalLabel1">Update Driver Info</h4>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			</div>
			<div class="modal-body">
				<form class="form-horizontal" method="POST" action="/admin/updateDriver" enctype="multipart/form-data" style="margin-left: 125px">
					<div class="row">
						<div class="col-md-5 col-md-4">
							<h5 class="mt-4 mb-2">Transporter</h5>
							<select class="mb-3 mr-2 btn btn-info btn-round trans" name="utrans" title="Choose Transporter">
								<option disabled selected value>Choose</option>
								<% for ( let i = 0; i < trans.length ; i++) { %>
								<option value="<%= trans[i].id %>" name="trans"><%= trans[i].name %></option>

								<% } %>
							</select>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">Name</h5>
							<input type="text" class="form-control col-md-12" name="uname" placeholder="Name" required />
						</div>
					</div>
					<div class="row">
						<div class="col-md-5 col-md-4">
							<h5 class="mt-4 mb-2">Select state</h5>
							<select class="mb-3 mr-2 btn btn-info btn-round state" name="ustate" data-size="10" title="Choose State" required>
								<% for ( let i = 0; i < state.length ; i++) { %>
								<option value="<%= state[i].state %>"><%= state[i].state %></option>
								<% } %>
							</select>
						</div>
						<div class="col-md-5 col-md-4">
							<h5 class="mt-4 mb-2">Select City</h5>
							<select class="mb-3 mr-2 btn btn-info btn-round id1" name="ucity" required>
								<option value="0">Choose City</option>
							</select>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">Mobile Number</h5>
							<input type="text" class="form-control col-md-12" name="uphn" placeholder="Mobile Number" required />
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">Birthday</h5>
							<div class="input-group">
								<input type="text" class="form-control datepicker" name="ubirthday" required placeholder="DD/MM/YYYY" />
								<div class="input-group-append">
									<span class="input-group-text"><i class="icon-calender"></i></span>
								</div>
							</div>
							<input type="text" name="driver" hidden />
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">Bank Account Number</h5>
							<input type="text" class="form-control col-md-12" name="ubankAcc" placeholder="Bank Account No." required />
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">D.L. Expiration Date</h5>
							<div class="input-group">
								<input type="text" class="form-control datepicker" name="ulice_exp" required placeholder="DD/MM/YYYY" />
								<div class="input-group-append">
									<span class="input-group-text"><i class="icon-calender"></i></span>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 col-md-6">
							<h5 class="mt-4 mb-2">Update Password</h5>
							<input type="password" class="form-control col-md-12" name="upassword" placeholder="Password" />
						</div>
					</div>
					<br />
					<div class="row">
						<div class="col-md-6 col-md-6">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">Update Profile Pic</h5>
									<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
									<input type="file" name="uprof_pic" class="dropify" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-md-6">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">Update Driver's License Front Pic</h5>
									<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
									<input type="file" name="udl_pic_front" class="dropify" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-md-6">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">Update Driver's License Back Pic</h5>
									<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
									<input type="file" name="udl_pic_back" class="dropify" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-md-6">
							<div class="card">
								<div class="card-body">
									<h5 class="card-title">Upadte Aadhaar</h5>
									<!--  <label for="input-file-now">Your so fresh input file — Default version</label> -->
									<input type="file" name="uaadhar_front_pic" class="dropify" />
								</div>
							</div>
						</div>
					</div>
					<br />
					<button type="submit" style="margin-left: 250px" class="btn waves-effect waves-light btn-rounded btn-info">Update</button>
				</form>
				<hr />
			</div>
		</div>
	</div>
</div>

<% include ../partials/footer %>
<script src="/js/typeahead.bundle.js"></script>
<script src="/plugins/dropify/dist/js/dropify.min.js"></script>
<script src="/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="/plugins/datatables/jszip.min.js"></script>
<script src="/plugins/datatables/pdfmake.min.js"></script>
<script src="/plugins/datatables/vfs_fonts.js"></script>
<script src="/plugins/datatables/buttons.html5.min.js"></script>
<script src="/plugins/datatables/buttons.colVis.min.js"></script>
<script src="/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="/plugins/datatables/responsive.bootstrap4.min.js"></script>

<script type="text/javascript">
	var state;
	$(document).ready(function () {
		$(".select2").select2();
		$(".state").change(function () {
			state = $(this).children("option:selected").val();
			stateFind(state);
		});
	});

	function stateFind(state) {
		$.ajax({
			url: "/admin/search",
			type: "post",
			data: {
				state: state,
			},
			dataType: "json",
			success: function (data) {
				var len = data.length;
				if (len > 0) {
					$(".id1").empty();
					for (var i = 0; i < len; i++) {
						var cid = data[i].id;
						var city = data[i].city;
						$(".id1").append("<option value='" + cid + "'>" + city + "</option>");
					}
				} else {
					$(".id1").empty();
					$(".id1").append("<option disabled selected>Choose</option>");
				}
			},
		});
	}
</script>

<script>
	$(".trans").change(function () {
		var option = $(this).children("option:selected").val();
		if (option == "self") {
			window.location.href = "/admin/self";
		}
	});
</script>

<script type="text/javascript">
	$(document).ready(function () {
		demo.initDateTimePicker();
		if ($(".slider").length != 0) {
			demo.initSliders();
		}
	});
</script>

<script>
	$(document).ready(function () {
		// Basic
		$(".dropify").dropify();
	});
</script>

<script>
	function validDriver(Did) {
		Swal.fire({
			title: "Verify Driver!!",
			text: "Do you want to verify?",
			type: "warning",
			showCancelButton: true,
			confirmButtonColor: "#3085d6",
			cancelButtonColor: "#d33",
			confirmButtonText: "Yes",
		}).then(function (result) {
			if (result.value === true) {
				window.location.href = `/admin/update/${Did}`;
			}
		});
		var audio = new Audio("/sounds/notification.mp3");
		audio.play();
	}
</script>

<script>
	function stateUpdate(state, cities) {
		$.ajax({
			url: "/admin/search",
			type: "post",
			data: {
				state: state,
			},
			dataType: "json",
			success: function (data) {
				var len = data.length;
				if (len > 0) {
					$(".id1").empty();
					for (var i = 0; i < len; i++) {
						var cid = data[i].id;
						var city = data[i].city;
						if (cid != cities) {
							$(".id1").append("<option value='" + cid + "'>" + city + "</option>");
						} else {
							$(".id1").append("<option selected value='" + cid + "'>" + city + "</option>");
						}
					}
				} else {
					$(".id1").empty();
					$(".id1").append("<option disabled selected>Choose</option>");
				}
			},
		});
	}

	$("#updateDriver").on("show.bs.modal", function (event) {
		Did = $(event.relatedTarget).attr("data-driver");
		$.ajax({
			url: "/admin/autoDriver",
			type: "post",
			data: {
				Did,
			},
			dataType: "json",
			success: function (data) {
				$("select[name='utrans']").val(data.result[0].tid);
				$("input[name='uname']").val(data.result[0].d_name);
				$("select[name='ustate']").val(data.result[0].state);
				stateUpdate(data.result[0].state, data.result[0].city);
				$("select[name='ucity']").val(data.result[0].city);
				$("input[name='uphn']").val(data.result[0].phn);
				$("input[name='ubirthday']").val(data.result[0].birthday);
				$("input[name='ulice_exp']").val(data.result[0].lice_exp);
				$("input[name='ubankAcc']").val(data.result[0].bankAccd);
				$("input[name='driver']").val(Did);
			},
		});
	});
</script>

<script>
	$(function () {
		$('a[data-toggle="tab"]').on("shown.bs.tab", function (e) {
			$($.fn.dataTable.tables(true)).DataTable().columns.adjust();
		});
		$("#datatable").DataTable({
			dom: "Bfrtip",
			buttons: [
				{
					extend: "csvHtml5",
					title: "Un-Verified Drivers",
				},
				{
					extend: "excelHtml5",
					title: "Un-Verified Drivers",
				},
			],
			scrollY: 600,
		});
		$("#datatable2").DataTable({
			dom: "Bfrtip",
			buttons: [
				{
					extend: "csvHtml5",
					title: "Verified Drivers",
				},
				{
					extend: "excelHtml5",
					title: "Verified Drivers",
				},
			],
			scrollY: 600,
		});
	});
</script>
